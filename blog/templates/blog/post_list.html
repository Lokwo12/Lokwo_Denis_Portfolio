{% extends 'base.html' %}
{% load static site_extras %}
{% block title %}Blog — Denis Lokwo{% endblock %}
{% block og_title %}Blog — Denis Lokwo{% endblock %}
{% block tw_title %}Blog — Denis Lokwo{% endblock %}
{% block head_meta %}
    <meta property="og:description" content="Articles, tutorials, and notes on building modern web apps.">
    <meta name="twitter:description" content="Articles, tutorials, and notes on building modern web apps.">
    <meta property="og:image" content="{% absolute_static 'images/og-default.svg' %}">
    <meta name="twitter:image" content="{% absolute_static 'images/og-default.svg' %}">
{% endblock %}
{% block content %}
<section class="blog-list container">
    <header class="contact-hero" style="margin-bottom:16px;">
        <span class="eyebrow">Insights & Updates</span>
        <h2 class="title" style="margin:4px 0 8px">Blog</h2>
        <p class="lead">Articles, tutorials, and notes on building modern web apps.</p>
    </header>

    <form method="get" class="project-filter" style="margin:0 0 24px;display:flex;gap:12px;flex-wrap:wrap">
        <input type="text" name="q" value="{{ q }}" placeholder="Search articles..." style="padding:10px 12px;border-radius:10px;border:1px solid var(--border);min-width:220px;flex:1">
        <button type="submit" class="btn secondary">Search</button>
    </form>

    {% for post in posts %}
        <article class="blog-post">
            <div class="bc-grid">
                <div class="bc-content">
                    <h3 style="margin:0 0 6px"><a href="{{ post.get_absolute_url }}">{{ post.title }}</a></h3>
                    <div class="badge-list" style="margin-bottom:8px">
                        <span class="chip">By {{ post.author }}</span>
                        <span class="chip">{{ post.created_at|date:"F j, Y" }}</span>
                        {% if post.category %}<a class="chip" href="{% url 'blog:post_list_by_category' category=post.category|slugify %}">{{ post.category }}</a>{% endif %}
                    </div>
                    <p style="margin:0 0 10px">{{ post.content|truncatewords:42 }}</p>
                    {% with tags=post.tag_list %}
                    {% if tags %}
                    <div class="badge-list" aria-label="Tags">
                        {% for t in tags %}
                        <a class="chip" href="{% url 'blog:post_list_by_tag' tag=t|slugify %}">#{{ t }}</a>
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% endwith %}
                    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px">
                        <a class="btn" href="{{ post.get_absolute_url }}">Read article</a>
                    </div>
                </div>
                {% if post.thumbnail %}
                <div class="bc-media">
                    <a href="{{ post.get_absolute_url }}" aria-label="View {{ post.title }}">
                        <img src="{{ post.thumbnail.url }}" alt="{{ post.title }} thumbnail" loading="lazy" decoding="async" fetchpriority="low" width="{{ post.thumbnail.width }}" height="{{ post.thumbnail.height }}" sizes="(max-width: 880px) 100vw, 300px">
                    </a>
                </div>
                {% endif %}
            </div>
        </article>
    {% empty %}
        <p>No blog posts found.</p>
    {% endfor %}

    {% if page_obj %}
    <nav class="pagination" aria-label="Pagination">
        {% if base_path %}
            {% if page_obj.has_previous %}
                <a class="page-link" href="{{ base_path }}?page={{ page_obj.previous_page_number }}">Previous</a>
            {% else %}
                <span class="page-link disabled">Previous</span>
            {% endif %}
            <span class="page-status">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
            {% if page_obj.has_next %}
                <a class="page-link" href="{{ base_path }}?page={{ page_obj.next_page_number }}">Next</a>
            {% else %}
                <span class="page-link disabled">Next</span>
            {% endif %}
        {% else %}
            {% if page_obj.has_previous %}
                <a class="page-link" href="?q={{ q|urlencode }}&page={{ page_obj.previous_page_number }}">Previous</a>
            {% else %}
                <span class="page-link disabled">Previous</span>
            {% endif %}
            <span class="page-status">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
            {% if page_obj.has_next %}
                <a class="page-link" href="?q={{ q|urlencode }}&page={{ page_obj.next_page_number }}">Next</a>
            {% else %}
                <span class="page-link disabled">Next</span>
            {% endif %}
        {% endif %}
    </nav>
    {% endif %}
</section>
{% endblock %}
